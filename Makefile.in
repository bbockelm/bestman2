##############################################################################
# Alex Sim <ASim@lbl.gov>
# Lawrence Berkeley National Laboratory
# January 31, 2011
##############################################################################
#
# Change only the following three lines for BESTMAN_HOME, JAVA_HOME, and ANT.
# BESTMAN_HOME is the path to the current bestman2 distribution tar package.
# BESTMAN_HOME should not be in the current src directory.
#
# make all  : To build, install and package bestman2 components
# make buildonly  : To build only
# make install  : To install only
# make buildpkg  : To make distributable tar file only
#
##############################################################################
#
BESTMAN_HOME	= @BESTMAN_HOME@
JAVA_HOME	= @JAVA_HOME@
ANTBIN	= @ANT_BINPATH@
MYHOST	= `hostname -f`
MYDATE	= `date`
#
##############################################################################
BESTMAN2VERSION	= 2.0.5
##############################################################################
##############################################################################
# Do NOT edit below
##############################################################################
BESTMAN2PRE	= bestman2-server-src
CLIENT2PRE	= bestman-client-src
TESTER2PRE	= srmtester3-src
##############################################################################
BESTMAN2PKG	= bestman2/*
CLIENT2PKG	= bestman-client/docs/INSTALL.client \
		bestman-client/LICENSE \
		bestman-client/COPYRIGHT \
		bestman-client/lib/bestman2-client.jar \
		bestman-client/lib/bestman2-transfer.jar \
		bestman-client/lib/bestman2-printintf.jar \
		bestman-client/lib/bestman2-stub.jar \
		bestman-client/lib/axis \
		bestman-client/lib/jglobus \
		bestman-client/properties \
		bestman-client/README \
		bestman-client/CHANGE \
		bestman-client/version \
		bestman-client/conf/srmclient.* \
		bestman-client/setup/configure \
		bestman-client/setup/bestman.in/g-u*.in \
		bestman-client/setup/bestman.in/srm-c*.in \
		bestman-client/setup/bestman.in/srm-d*.in \
		bestman-client/setup/bestman.in/srm-e*.in \
		bestman-client/setup/bestman.in/srm-l*.in \
		bestman-client/setup/bestman.in/srm-m*.in \
		bestman-client/setup/bestman.in/srm-p*.in \
		bestman-client/setup/bestman.in/srm-r*.in \
		bestman-client/setup/bestman.in/srm-s*.in \
		bestman-client/setup/bestman.in/srm-tr*.in \
		bestman-client/setup/bestman.in/srm-u*.in
TESTER2PKG	= srmtester3/docs/INSTALL.tester \
		srmtester3/LICENSE \
		srmtester3/COPYRIGHT \
		srmtester3/lib/bestman2-stub.jar \
		srmtester3/lib/bestman2-printintf.jar \
		srmtester3/lib/bestman2-transfer.jar \
		srmtester3/lib/bestman2-tester-driver.jar \
		srmtester3/lib/bestman2-tester-main.jar \
		srmtester3/lib/axis \
		srmtester3/lib/jglobus \
		srmtester3/properties \
		srmtester3/README \
		srmtester3/CHANGE \
		srmtester3/version \
		srmtester3/conf/srmtester.* \
		srmtester3/setup/configure \
		srmtester3/setup/bestman.in/g-u*.in \
		srmtester3/setup/bestman.in/srmtester.conf.in \
		srmtester3/setup/bestman.in/srm-tester.in

##############################################################################
##############################################################################
all	: depend server2build server2install client2build client2install tester2build tester2install server2pkg client2pkg tester2pkg
buildonly	: depend server2build client2build tester2build 
install	: server2install client2install tester2install 
buildpkg	: server2pkg client2pkg tester2pkg
##############################################################################
server2build:
	@ echo "########################################"
	@ echo "BeStMan2 Server build for version $(BESTMAN2VERSION)"
	@ cd $(BESTMAN2PRE); export JAVA_HOME=$(JAVA_HOME); $(ANTBIN)
	@ ls -l $(BESTMAN2PRE)/build/lib/*.jar
	@ echo ""

server2install:
	@ echo "########################################"
	@ echo "BeStMan2 Server install for version $(BESTMAN2VERSION)"
	@ cd $(BESTMAN2PRE); export JAVA_HOME=$(JAVA_HOME); $(ANTBIN) install
	@ echo ""

server2clean:
	@ echo "########################################"
	@ echo "BeStMan2 Server clean for version $(BESTMAN2VERSION)"
	@ cd $(BESTMAN2PRE); export JAVA_HOME=$(JAVA_HOME); $(ANTBIN) clean
	@ echo ""
##############################################################################
client2build:
	@ echo "########################################"
	@ echo "BeStMan2 Client build for version $(BESTMAN2VERSION)"
	@ cd $(CLIENT2PRE); export JAVA_HOME=$(JAVA_HOME); $(ANTBIN)
	@ ls -l $(CLIENT2PRE)/build/lib/*.jar
	@ echo ""

client2install:
	@ echo "########################################"
	@ echo "BeStMan2 Client install for version $(BESTMAN2VERSION)"
	@ cd $(CLIENT2PRE); export JAVA_HOME=$(JAVA_HOME); $(ANTBIN) install
	@ echo ""

client2clean:
	@ echo "########################################"
	@ echo "BeStMan2 Client clean for version $(BESTMAN2VERSION)"
	@ cd $(CLIENT2PRE); export JAVA_HOME=$(JAVA_HOME); $(ANTBIN) clean
	@ echo ""
##############################################################################
tester2build:
	@ echo "########################################"
	@ echo "BeStMan2 Tester build for version $(BESTMAN2VERSION)"
	@ cd $(TESTER2PRE); export JAVA_HOME=$(JAVA_HOME); $(ANTBIN)
	@ ls -l $(TESTER2PRE)/build/lib/*.jar
	@ echo ""

tester2install:
	@ echo "########################################"
	@ echo "BeStMan2 Tester install for version $(BESTMAN2VERSION)"
	@ cd $(TESTER2PRE); export JAVA_HOME=$(JAVA_HOME); $(ANTBIN) install
	@ echo ""

tester2clean:
	@ echo "########################################"
	@ echo "BeStMan2 Tester clean for version $(BESTMAN2VERSION)"
	@ cd $(TESTER2PRE); export JAVA_HOME=$(JAVA_HOME); $(ANTBIN) clean
	@ echo ""
##############################################################################
depend:
	@ echo "making build.properties"
	@ echo "javac.path=$(JAVA_HOME)/bin/javac"
	@ echo "bestman.root=$(BESTMAN_HOME)"
	@ echo "javac.path=$(JAVA_HOME)/bin/javac" > build.properties
	@ echo "bestman.root=$(BESTMAN_HOME)" >> build.properties 
	@ echo "interface.name=StorageResourceManager" >> build.properties
	@ echo "pkgname=bestman2" >> build.properties
	@ echo "package=gov.lbl.srm" >> build.properties
	@ echo "package.dir=gov/lbl/srm" >> build.properties
	@ echo "wsdl.tool=org.apache.axis.wsdl.WSDL2Java" >> build.properties
	@ cp -f build.properties $(BESTMAN2PRE)
	@ cp -f build.properties $(CLIENT2PRE)
	@ cp -f build.properties $(TESTER2PRE)
	@ echo  " " >> $(BESTMAN_HOME)/version
	@ echo  "BUILT  $(MYDATE)  on  $(MYHOST)" >> $(BESTMAN_HOME)/version
##############################################################################
##############################################################################
server2pkg:
	@ echo "######################################################"
	@ echo "BeStMan2 packaging for version $(BESTMAN2VERSION)"
	@ ln -s $(BESTMAN_HOME) bestman2
	@ tar zcf bestman2-$(BESTMAN2VERSION).tar.gz $(BESTMAN2PKG)
	@ \rm -f bestman2
	@ @ echo "BeStMan2 PKG"
	ls -l bestman2-$(BESTMAN2VERSION).tar.gz
	@ echo ""
##############################################################################
client2pkg:
	@ echo "######################################################"
	@ echo "BeStMan2 Client packaging for version $(BESTMAN2VERSION)"
	@ ln -s $(BESTMAN_HOME) bestman-client
	@ tar zcf bestman-client-$(BESTMAN2VERSION).tar.gz $(CLIENT2PKG)    
	@ \rm -f bestman-client
	@ echo "BeStMan2 CLIENT PKG"
	ls -l bestman-client-$(BESTMAN2VERSION).tar.gz
	@ echo ""
##############################################################################
tester2pkg:
	@ echo "######################################################"
	@ echo "BeStMan2 Tester packaging for version $(BESTMAN2VERSION)"
	@ ln -s $(BESTMAN_HOME) srmtester3
	@ tar zcf srmtester3-$(BESTMAN2VERSION).tar.gz $(TESTER2PKG)
	@ \rm -f srmtester3
	@ echo "BeStMan2 TESTER PKG"
	ls -l srmtester3-$(BESTMAN2VERSION).tar.gz
	@ echo ""
##############################################################################
